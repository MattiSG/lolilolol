---
layout: default
---

<div class="fr-container fr-py-6w">
    <h1 id="search-page-title">Résultat(s) de la recherche</h1>

    <ul id="search-results" class="fr-raw-list fr-mb-0"></ul>
</div>

<script src="https://unpkg.com/lunr/lunr.js"></script>
<script>
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');

        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=');

            if (pair[0] === variable) {
                return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
            }
        }
    }

    function displaySearchResults(results, store) {
        var searchResults = document.getElementById('search-results');
        var searchPageTitle = document.getElementById('search-page-title');
        
        if (results.length) {
            var appendString = '';

            for (var i = 0; i < results.length; i++) {
                var item = store[results[i].ref];
                appendString += '<li><a class="fr-link fr-fi-arrow-right-line fr-link--icon-left" href="' + item.url + '">' + item.title + '</a></li>';
            }

            searchResults.innerHTML = appendString;
            searchPageTitle.innerHTML = '<strong id="nbResults">' + results.length + '&nbsp;résultat(s)</strong> pour : <strong>«&nbsp;' + searchTerm + '&nbsp;»</strong>';
        } else {
            searchResults.innerHTML = '';
            searchPageTitle.innerHTML = '<strong>Aucun&nbsp;résultat</strong> pour : <strong>«&nbsp;' + searchTerm + '&nbsp;»</strong>';
        }
    }

    // Replace to trim the query, removing extra white spaces
    var searchTerm = getQueryVariable('q').replace(/^\s+|\s+$/g, '');

    document.getElementById('search').setAttribute("value", searchTerm);

    window.store = {
        {% for startup in site.startups %}
            {% assign startup_id = startup.id | remove: "/startups/" %}

            {% assign team = site.authors | where:"startups", startup_id %}
            {% assign current_team = "" %}
            {% for people in team %}
            {% capture to_append %}{{people.fullname}}, {% endcapture %}
            {% assign current_team = current_team | append: to_append %}
            {% endfor %}

            {% assign team = site.authors | where:"previously", startup_id %}
            {% assign past_team = "" %}
            {% for people in team %}
            {% capture to_append %}{{people.fullname}}, {% endcapture %}
            {% assign past_team = past_team | append: to_append %}
            {% endfor %}

            "{{ startup_id }}" : {
                "title"         : "{{ startup.title | escape }}",
                "mission"       : "{{ startup.mission | escape }}",
                "incubator"     : "{{ startup.incubator | escape }}",
                "url"           : "{{ site.baseurl }}{{ startup.url }}",
                "contact"       : "{{ startup.contact }}",
                "current_team"  : "{{ current_team }}",
                "past_team"     : "{{ past_team }}"
            } {% unless forloop.last %},{% endunless %}
        {% endfor %}
    };

    var idx = lunr(function () {
        this.field('title', { boost: 10 });
        this.field('mission');
        this.field('incubator');
        this.field('url');
        this.field('contact');
        this.field('current_team');
        this.field('past_team');
        for (var key in window.store) { 
            this.add({
                'id': key,
                'title': window.store[key].title,
                'mission': window.store[key].mission,
                'incubator': window.store[key].incubator,
                'url': window.store[key].url,
                'contact': window.store[key].contact,
                'current_team': window.store[key].current_team,
                'past_team': window.store[key].past_team
            });
        }
    });

    var results = idx.search(searchTerm);
    displaySearchResults(results, window.store);
</script>