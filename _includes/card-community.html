{%- comment -%}
  Appeler cette page avec un author
  Ex : {%- include card-community.html author=author -%}
{%- endcomment -%}

{%- assign author= include.author -%}

{%- comment -%}
  Détecter si l'author est actif ou non. Par défaut, oui.
{%- endcomment -%}

{%- capture label -%}label--active{%- endcapture -%}

{%- if author.missions.last.end -%}
  {%- capture timestampNow -%}{{ 'now' | date: '%s' }}{%- endcapture -%}
  {%- capture timestampEnd -%}{{ author.missions.last.end | date: '%s' }}{%- endcapture -%}
  {%- if timestampNow > timestampEnd -%}
    {%- capture label -%}label--inactive{%- endcapture -%}
  {%- endif -%}
{%- endif -%}

<div class="rf-card rf-card__img__rounded {% if author.link %}rf-enlarge-link{% else %}rf-card--no-arrow{% endif %}">
  <div class="rf-card__img">
    {%- include avatar.html author=author force=true rounded=true -%}
  </div>
  <div class="rf-card__body">
    <h4 class="rf-card__title">
        {%- if author.link -%}
          <a class="rf-card__link" href="{{ author.link }}" target="\_blank" rel="noopener">{{ author.fullname }}</a>
        {%- else -%}
          {{ author.fullname }}
        {%- endif -%}
    </h4>
    <p class="rf-card__detail">{{ author.role }}</p>
    {%- if author.content != '' and author.content != nil and author.content != blank -%}
    <p class="rf-card__desc">{{ author.raw_content }}</p>
    {%- endif -%}
  </div>


  {%- if total_startups -%}
  <div class="card__extra">
    {%- for startup in total_startups -%}
      {%- capture startup_label -%}{{ label }}{%- endcapture -%}
      {%- if author.previously contains startup -%}
          {%- capture startup_label -%}label--inactive{%- endcapture -%}
      {%- endif -%}
      {%- if forloop.index > 5 -%}
        <div class="label label--inactive">Et {{ taille_autres }} autres</div>
        {%- break -%}
      {%- endif -%}

      {%- if startup == "_help_me_" -%}
        {%- continue -%}
      {%- endif -%}
      {%- if startup == "_in_progress_" -%}
        <div class="label {{ startup_label }}">Fiche produit à venir</div>
        {%- continue -%}
      {%- endif -%}
      {%- if startup == "_alpha_" -%}
        <div class="label {{ startup_label }}"><a href="approche/formation">Formation Alpha</a></div>
        {%- continue -%}
      {%- endif -%}
      {%- if startup == "_openfisca_" -%}
        <div class="label {{ startup_label }}"><a href="https://openfisca.org/">OpenFisca</a></div>
        {%- continue -%}
      {%- endif -%}
      {%- if startup == "_help_me_" -%}
        {%- continue -%}
      {%- endif -%}
      {%- capture startup_id -%}/startups/{{ startup }}{%- endcapture -%}
      {%- assign this_startup = site.startups | where: "id", startup_id | first -%}
      <div class="label {{ startup_label }}"><a href="{{ this_startup.url }}">{{ this_startup.title }}</a></div>
    {%- endfor -%}
  </div>
{%- endif -%}
</div>
